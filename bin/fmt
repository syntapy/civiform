#! /bin/bash
echo "Making sure we're up to date with the latest formatter..."
if ! sudo docker pull public.ecr.aws/t1q6b4h2/civiform-formatter:latest; then
	echo "Failed to pull - possibly some stuck credentials.  De-authenticating then retrying..."
	sudo docker logout https://public.ecr.aws/t1q6b4h2/civiform-formatter
	sudo docker pull public.ecr.aws/t1q6b4h2/civiform-formatter:latest
fi

if [ $(basename "$PWD") == "universal-application-tool-0.0.1" ]; then
	sudo docker run --rm -it -v "${PWD}/:/code" public.ecr.aws/t1q6b4h2/civiform-formatter:latest
else
	sudo docker run --rm -it -v "${PWD}/universal-application-tool-0.0.1/:/code" public.ecr.aws/t1q6b4h2/civiform-formatter:latest
fi
